{"version":3,"sources":["src/PivotTableUI.jsx"],"names":["DraggableAttribute","props","state","open","top","left","filterText","value","valueFilter","removeValuesFromFilter","name","addValuesToFilter","x","toLowerCase","trim","includes","e","stopPropagation","setValuesInFilter","Object","keys","attrValues","filter","y","showMenu","length","menuLimit","values","shown","matchesFilter","bind","sort","sorter","display","cursor","zIndex","moveFilterBoxToTop","setState","target","map","toggleValue","selectOnly","event","bodyRect","document","body","getBoundingClientRect","rect","nativeEvent","filtered","renderAttributeKey","toggleFilterBox","getFilterBox","React","Component","defaultProps","propTypes","PropTypes","string","isRequired","func","objectOf","number","bool","Dropdown","toggle","current","render","r","setValue","PureComponent","PivotTableUI","unusedOrder","zIndices","maxZIndex","openDropdown","initializeValueFilter","materializeInput","data","nextProps","key","nextData","materializedInput","recordsProcessed","PivotData","forEachRecord","derivedAttributes","record","push","attr","null","command","nextState","aggregators","renderAggregatorName","renderAttributeValue","renderRendererName","renderers","sorters","tableColorScaleGenerator","onChange","sendPropUpdate","$set","attribute","reduce","v","$unset","dropdown","items","classes","group","ghostClass","preventOnFilter","numValsAllowed","aggregatorName","numInputs","rendererName","rendererCell","isOpen","propUpdater","sortIcons","key_a_to_z","rowSymbol","faSortAlphaDown","colSymbol","next","value_a_to_z","faSortNumericDown","value_z_to_a","faSortNumericUp","aggregatorCell","alignItems","rowOrder","colOrder","Array","fill","n","i","vals","hiddenAttributes","hiddenFromAggregators","$splice","unusedAttrs","rows","cols","hiddenFromDragDrop","unusedLength","horizUnused","unusedOrientationCutoff","unusedAttrsCell","makeDnDCell","order","colAttrs","colAttrsCell","rowAttrs","rowAttrsCell","outputCell","className","split","join","assign","PivotTable","arrayOf"],"mappings":"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","file":"PivotTableUI.js","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport update from 'immutability-helper';\nimport {PivotData, sortAs, getSort} from './Utilities';\nimport PivotTable from './PivotTable';\nimport Sortable from 'react-sortablejs';\nimport Draggable from 'react-draggable';\n\nimport faSortAlphaDown from '@fortawesome/fontawesome-free-solid/faSortAlphaDown'\nimport faSortNumericDown from '@fortawesome/fontawesome-free-solid/faSortNumericDown'\nimport faSortNumericUp from '@fortawesome/fontawesome-free-solid/faSortNumericUp'\nimport FontAwesomeIcon from '@fortawesome/react-fontawesome'\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore'\nimport SettingsIcon from '@material-ui/icons/Settings'\nimport IconButton from '@material-ui/core/IconButton'\nimport classnames from 'classnames'\n\n/* eslint-disable react/prop-types */\n// eslint can't see inherited propTypes!\n\nexport class DraggableAttribute extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {open: false, top: 0, left: 0, filterText: ''};\n  }\n\n  toggleValue(value) {\n    if (value in this.props.valueFilter) {\n      this.props.removeValuesFromFilter(this.props.name, [value]);\n    } else {\n      this.props.addValuesToFilter(this.props.name, [value]);\n    }\n  }\n\n  matchesFilter(x) {\n    return x\n      .toLowerCase()\n      .trim()\n      .includes(this.state.filterText.toLowerCase().trim());\n  }\n\n  selectOnly(e, value) {\n    e.stopPropagation();\n    this.props.setValuesInFilter(\n      this.props.name,\n      Object.keys(this.props.attrValues).filter(y => y !== value)\n    );\n  }\n\n  getFilterBox() {\n    const showMenu =\n      Object.keys(this.props.attrValues).length < this.props.menuLimit;\n\n    const values = Object.keys(this.props.attrValues);\n    const shown = values\n      .filter(this.matchesFilter.bind(this))\n      .sort(this.props.sorter);\n\n    return (\n      <Draggable handle=\".pvtDragHandle\">\n        <div\n          className=\"pvtFilterBox\"\n          style={{\n            display: 'block',\n            cursor: 'initial',\n            zIndex: this.props.zIndex,\n            top: this.state.top + 'px',\n            left: this.state.left + 'px',\n          }}\n          onClick={() => this.props.moveFilterBoxToTop(this.props.name)}\n        >\n          <a onClick={() => this.setState({open: false})} className=\"pvtCloseX\">\n            ×\n          </a>\n          <span className=\"pvtDragHandle\">☰</span>\n          <h4>{this.props.name}</h4>\n\n          {showMenu || <p>(too many values to show)</p>}\n\n          {showMenu && (\n            <p>\n              <input\n                type=\"text\"\n                placeholder=\"Filter values\"\n                className=\"pvtSearch\"\n                value={this.state.filterText}\n                onChange={e =>\n                  this.setState({\n                    filterText: e.target.value,\n                  })\n                }\n              />\n              <br />\n              <a\n                role=\"button\"\n                className=\"pvtButton\"\n                onClick={() =>\n                  this.props.removeValuesFromFilter(\n                    this.props.name,\n                    Object.keys(this.props.attrValues).filter(\n                      this.matchesFilter.bind(this)\n                    )\n                  )\n                }\n              >\n                Select {values.length === shown.length ? 'All' : shown.length}\n              </a>{' '}\n              <a\n                role=\"button\"\n                className=\"pvtButton\"\n                onClick={() =>\n                  this.props.addValuesToFilter(\n                    this.props.name,\n                    Object.keys(this.props.attrValues).filter(\n                      this.matchesFilter.bind(this)\n                    )\n                  )\n                }\n              >\n                Deselect {values.length === shown.length ? 'All' : shown.length}\n              </a>\n            </p>\n          )}\n\n          {showMenu && (\n            <div className=\"pvtCheckContainer\">\n              {shown.map(x => (\n                <p\n                  key={x}\n                  onClick={() => this.toggleValue(x)}\n                  className={x in this.props.valueFilter ? '' : 'selected'}\n                >\n                  <a className=\"pvtOnly\" onClick={e => this.selectOnly(e, x)}>\n                    only\n                  </a>\n                  <a className=\"pvtOnlySpacer\">&nbsp;</a>\n\n                  {x === '' ? <em>null</em> : x}\n                </p>\n              ))}\n            </div>\n          )}\n        </div>\n      </Draggable>\n    );\n  }\n\n  toggleFilterBox(event) {\n    const bodyRect = document.body.getBoundingClientRect();\n    const rect = event.nativeEvent.target.getBoundingClientRect();\n    this.setState({\n      open: !this.state.open,\n      top: 10 + rect.top - bodyRect.top,\n      left: 10 + rect.left - bodyRect.left,\n    });\n    this.props.moveFilterBoxToTop(this.props.name);\n  }\n\n  render() {\n    const filtered =\n      Object.keys(this.props.valueFilter).length !== 0\n        ? 'pvtFilteredAttribute'\n        : '';\n    return (\n      <li data-id={this.props.name}>\n        <span className={'pvtAttr ' + filtered}>\n          <span className='text'>\n            {this.props.renderAttributeKey(this.props.name)}\n          </span>\n          <IconButton\n            className=\"pvtTriangle\"\n            onClick={this.toggleFilterBox.bind(this)}\n          >\n            <SettingsIcon />\n          </IconButton>\n        </span>\n\n        {this.state.open ? this.getFilterBox() : null}\n      </li>\n    );\n  }\n}\n\nDraggableAttribute.defaultProps = {\n  valueFilter: {},\n};\n\nDraggableAttribute.propTypes = {\n  name: PropTypes.string.isRequired,\n  addValuesToFilter: PropTypes.func.isRequired,\n  removeValuesFromFilter: PropTypes.func.isRequired,\n  attrValues: PropTypes.objectOf(PropTypes.number).isRequired,\n  valueFilter: PropTypes.objectOf(PropTypes.bool),\n  moveFilterBoxToTop: PropTypes.func.isRequired,\n  sorter: PropTypes.func.isRequired,\n  menuLimit: PropTypes.number,\n  zIndex: PropTypes.number,\n};\n\nexport class Dropdown extends React.PureComponent {\n  render() {\n    return (\n      <div className=\"pvtDropdown\" style={{zIndex: this.props.zIndex}}>\n        <div\n          onClick={e => {\n            e.stopPropagation();\n            this.props.toggle();\n          }}\n          className={\n            'pvtDropdownValue pvtDropdownCurrent ' +\n            (this.props.open ? 'pvtDropdownCurrentOpen' : '')\n          }\n          role=\"button\"\n        >\n          <IconButton className={classnames(\"pvtDropdownIcon\", { open: this.props.open })}>\n            <ExpandMoreIcon />\n          </IconButton>\n          {this.props.current\n            ? this.props.render(this.props.current)\n            : <span>&nbsp;</span>\n          }\n        </div>\n\n        {this.props.open && (\n          <div className=\"pvtDropdownMenu\">\n            {this.props.values.map(r => (\n              <div\n                key={r}\n                role=\"button\"\n                onClick={e => {\n                  e.stopPropagation();\n                  this.props.toggle();\n                  this.props.setValue(r);\n                }}\n                className={\n                  'pvtDropdownValue ' +\n                  (r === this.props.current ? 'pvtDropdownActiveValue' : '')\n                }\n              >\n                {this.props.render(r)}\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n    );\n  }\n}\n\nDropdown.defaultProps = {\n  render: x => x\n}\n\nclass PivotTableUI extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      unusedOrder: [],\n      zIndices: {},\n      maxZIndex: 1000,\n      openDropdown: false,\n    };\n    this.initializeValueFilter(props)\n  }\n\n  componentWillMount() {\n    this.materializeInput(this.props.data);\n  }\n\n  componentWillUpdate(nextProps) {\n    this.materializeInput(nextProps.data);\n    this.initializeValueFilter(nextProps)\n  }\n\n  initializeValueFilter(props) {\n    if (Object.keys(props.valueFilter).length === 0) {\n      if (props.data.length > 0) {\n        const keys = Object.keys(props.data[0])\n        for (const key of keys) {\n          props.valueFilter[key] = {}\n        }\n      }\n    }\n  }\n\n  materializeInput(nextData) {\n    if (this.data === nextData) {\n      return;\n    }\n    this.data = nextData;\n    const attrValues = {};\n    const materializedInput = [];\n    let recordsProcessed = 0;\n    PivotData.forEachRecord(this.data, this.props.derivedAttributes, function(\n      record\n    ) {\n      materializedInput.push(record);\n      for (const attr of Object.keys(record)) {\n        if (!(attr in attrValues)) {\n          attrValues[attr] = {};\n          if (recordsProcessed > 0) {\n            attrValues[attr].null = recordsProcessed;\n          }\n        }\n      }\n      for (const attr in attrValues) {\n        const value = attr in record ? record[attr] : 'null';\n        if (!(value in attrValues[attr])) {\n          attrValues[attr][value] = 0;\n        }\n        attrValues[attr][value]++;\n      }\n      recordsProcessed++;\n    });\n\n    this.materializedInput = materializedInput;\n    this.attrValues = attrValues;\n  }\n\n  sendPropUpdate(command) {\n    const nextState = update(this.props, command)\n\n    delete nextState.aggregators\n    delete nextState.data\n    delete nextState.derivedAttributes\n    delete nextState.renderAggregatorName\n    delete nextState.renderAttributeKey\n    delete nextState.renderAttributeValue\n    delete nextState.renderRendererName\n    delete nextState.renderers\n    delete nextState.sorters\n    delete nextState.tableColorScaleGenerator\n    delete nextState.onChange\n    \n    this.props.onChange(nextState);\n  }\n\n  propUpdater(key) {\n    return value => this.sendPropUpdate({[key]: {$set: value}});\n  }\n\n  setValuesInFilter(attribute, values) {\n    this.sendPropUpdate({\n      valueFilter: {\n        [attribute]: {\n          $set: values.reduce((r, v) => {\n            r[v] = true;\n            return r;\n          }, {}),\n        },\n      },\n    });\n  }\n\n  addValuesToFilter(attribute, values) {\n    if (attribute in this.props.valueFilter) {\n      this.sendPropUpdate({\n        valueFilter: {\n          [attribute]: values.reduce((r, v) => {\n            r[v] = {$set: true};\n            return r;\n          }, {}),\n        },\n      });\n    } else {\n      this.setValuesInFilter(attribute, values);\n    }\n  }\n\n  removeValuesFromFilter(attribute, values) {\n    this.sendPropUpdate({\n      valueFilter: {[attribute]: {$unset: values}},\n    });\n  }\n\n  moveFilterBoxToTop(attribute) {\n    this.setState(\n      update(this.state, {\n        maxZIndex: {$set: this.state.maxZIndex + 1},\n        zIndices: {[attribute]: {$set: this.state.maxZIndex + 1}},\n      })\n    );\n  }\n\n  isOpen(dropdown) {\n    return this.state.openDropdown === dropdown;\n  }\n\n  makeDnDCell(items, onChange, classes) {\n    return (\n      <Sortable\n        options={{\n          group: 'shared',\n          ghostClass: 'pvtPlaceholder',\n          filter: '.pvtFilterBox',\n          preventOnFilter: false,\n        }}\n        tag=\"td\"\n        className={classes}\n        onChange={onChange}\n      >\n        {items.map(x => (\n          <DraggableAttribute\n            name={x}\n            key={x}\n            attrValues={this.attrValues[x]}\n            valueFilter={this.props.valueFilter[x] || {}}\n            sorter={getSort(this.props.sorters, x)}\n            menuLimit={this.props.menuLimit}\n            setValuesInFilter={this.setValuesInFilter.bind(this)}\n            addValuesToFilter={this.addValuesToFilter.bind(this)}\n            moveFilterBoxToTop={this.moveFilterBoxToTop.bind(this)}\n            removeValuesFromFilter={this.removeValuesFromFilter.bind(this)}\n            zIndex={this.state.zIndices[x] || this.state.maxZIndex}\n            renderAttributeKey={this.props.renderAttributeKey || (x => x)}\n          />\n        ))}\n      </Sortable>\n    );\n  }\n\n  render() {\n    const numValsAllowed =\n      this.props.aggregators[this.props.aggregatorName]([])().numInputs || 0;\n\n    const rendererName =\n      this.props.rendererName in this.props.renderers\n        ? this.props.rendererName\n        : Object.keys(this.props.renderers)[0];\n\n    const rendererCell = (\n      <td className=\"pvtRenderers\">\n        <Dropdown\n          current={rendererName}\n          values={Object.keys(this.props.renderers)}\n          open={this.isOpen('renderer')}\n          zIndex={this.isOpen('renderer') ? this.state.maxZIndex + 1 : 1}\n          toggle={() =>\n            this.setState({\n              openDropdown: this.isOpen('renderer') ? false : 'renderer',\n            })\n          }\n          setValue={this.propUpdater('rendererName')}\n          render={this.props.renderRendererName}\n        />\n      </td>\n    );\n\n    const sortIcons = {\n      key_a_to_z: {\n        rowSymbol: <FontAwesomeIcon icon={faSortAlphaDown} />,\n        colSymbol: <FontAwesomeIcon icon={faSortAlphaDown} />,\n        next: 'value_a_to_z',\n      },\n      value_a_to_z: {\n        rowSymbol: <FontAwesomeIcon icon={faSortNumericDown} />,\n        colSymbol: <FontAwesomeIcon icon={faSortNumericDown} />,\n        next: 'value_z_to_a',\n      },\n      value_z_to_a: {\n        rowSymbol: <FontAwesomeIcon icon={faSortNumericUp} />,\n        colSymbol: <FontAwesomeIcon icon={faSortNumericUp} />,\n        next: 'key_a_to_z'\n      },\n    };\n\n    const aggregatorCell = (\n      <td className=\"pvtVals\">\n        <div style={{ alignItems: 'center', display: 'flex' }}>\n          <Dropdown\n            current={this.props.aggregatorName}\n            values={Object.keys(this.props.aggregators)}\n            open={this.isOpen('aggregators')}\n            zIndex={this.isOpen('aggregators') ? this.state.maxZIndex + 1 : 1}\n            toggle={() =>\n              this.setState({\n                openDropdown: this.isOpen('aggregators') ? false : 'aggregators',\n              })\n            }\n            setValue={this.propUpdater('aggregatorName')}\n            render={this.props.renderAggregatorName}\n          />\n          <IconButton\n            role=\"button\"\n            className=\"pvtRowOrder\"\n            onClick={() =>\n              this.propUpdater('rowOrder')(sortIcons[this.props.rowOrder].next)\n            }\n          >\n            {sortIcons[this.props.rowOrder].rowSymbol}\n          </IconButton>\n          <IconButton\n            role=\"button\"\n            className=\"pvtColOrder\"\n            onClick={() =>\n              this.propUpdater('colOrder')(sortIcons[this.props.colOrder].next)\n            }\n          >\n            {sortIcons[this.props.colOrder].colSymbol}\n          </IconButton>\n        </div>\n        {new Array(numValsAllowed).fill().map((n, i) => [\n          <Dropdown\n            key={i}\n            current={this.props.vals[i]}\n            values={Object.keys(this.attrValues).filter(\n              e =>\n                !this.props.hiddenAttributes.includes(e) &&\n                !this.props.hiddenFromAggregators.includes(e)\n            )}\n            open={this.isOpen(`val${i}`)}\n            zIndex={this.isOpen(`val${i}`) ? this.state.maxZIndex + 1 : 1}\n            toggle={() =>\n              this.setState({\n                openDropdown: this.isOpen(`val${i}`) ? false : `val${i}`,\n              })\n            }\n            setValue={value =>\n              this.sendPropUpdate({\n                vals: {$splice: [[i, 1, value]]},\n              })\n            }\n            render={this.props.renderAttributeKey}\n          />,\n          i + 1 !== numValsAllowed ? <br key={`br${i}`} /> : null,\n        ])}\n      </td>\n    );\n\n    const unusedAttrs = Object.keys(this.attrValues)\n      .filter(\n        e =>\n          !this.props.rows.includes(e) &&\n          !this.props.cols.includes(e) &&\n          !this.props.hiddenAttributes.includes(e) &&\n          !this.props.hiddenFromDragDrop.includes(e)\n      )\n      .sort(sortAs(this.state.unusedOrder));\n\n    const unusedLength = unusedAttrs.reduce((r, e) => r + e.length, 0);\n    const horizUnused = unusedLength < this.props.unusedOrientationCutoff;\n\n    const unusedAttrsCell = this.makeDnDCell(\n      unusedAttrs,\n      order => this.setState({unusedOrder: order}),\n      `pvtAxisContainer pvtUnused ${\n        horizUnused ? 'pvtHorizList' : 'pvtVertList'\n      }`\n    );\n\n    const colAttrs = this.props.cols.filter(\n      e =>\n        !this.props.hiddenAttributes.includes(e) &&\n        !this.props.hiddenFromDragDrop.includes(e)\n    );\n\n    const colAttrsCell = this.makeDnDCell(\n      colAttrs,\n      this.propUpdater('cols'),\n      'pvtAxisContainer pvtHorizList pvtCols'\n    );\n\n    const rowAttrs = this.props.rows.filter(\n      e =>\n        !this.props.hiddenAttributes.includes(e) &&\n        !this.props.hiddenFromDragDrop.includes(e)\n    );\n    const rowAttrsCell = this.makeDnDCell(\n      rowAttrs,\n      this.propUpdater('rows'),\n      'pvtAxisContainer pvtVertList pvtRows'\n    );\n    const outputCell = (\n      <td className=\"pvtOutput\">\n        <div className=\"container\">\n          <PivotTable\n            {...update(this.props, {\n              data: {$set: this.materializedInput},\n            })}\n          />\n        </div>\n      </td>\n    );\n\n    let className = this.props.className\n    if (className && className.length > 0) {\n      className = className.split('\\\\s+')\n    }\n    else {\n      className = []\n    }\n    className.push('pvtUi')\n    className = className.join(' ')\n\n    if (horizUnused) {\n      return (\n        <table className={className}>\n          <tbody onClick={() => this.setState({openDropdown: false})}>\n            <tr>\n              {rendererCell}\n              {unusedAttrsCell}\n            </tr>\n            <tr>\n              {aggregatorCell}\n              {colAttrsCell}\n            </tr>\n            <tr>\n              {rowAttrsCell}\n              {outputCell}\n            </tr>\n          </tbody>\n        </table>\n      );\n    }\n\n    return (\n      <table className={className}>\n        <tbody onClick={() => this.setState({openDropdown: false})}>\n          <tr>\n            {rendererCell}\n            {aggregatorCell}\n            {colAttrsCell}\n          </tr>\n          <tr>\n            {unusedAttrsCell}\n            {rowAttrsCell}\n            {outputCell}\n          </tr>\n        </tbody>\n      </table>\n    );\n  }\n}\n\nPivotTableUI.propTypes = Object.assign({}, PivotTable.propTypes, {\n  onChange: PropTypes.func.isRequired,\n  hiddenAttributes: PropTypes.arrayOf(PropTypes.string),\n  hiddenFromAggregators: PropTypes.arrayOf(PropTypes.string),\n  hiddenFromDragDrop: PropTypes.arrayOf(PropTypes.string),\n  unusedOrientationCutoff: PropTypes.number,\n  menuLimit: PropTypes.number,\n});\n\nPivotTableUI.defaultProps = Object.assign({}, PivotTable.defaultProps, {\n  hiddenAttributes: [],\n  hiddenFromAggregators: [],\n  hiddenFromDragDrop: [],\n  unusedOrientationCutoff: 85,\n  menuLimit: 500,\n});\n\nexport default PivotTableUI;\n"]}